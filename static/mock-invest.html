<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë¥´ë‹¤ - ëª¨ì˜íˆ¬ì</title>
    
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/page.css">
</head>
<body>
    <div class="layout">
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">ì˜¤ë¥´ë‹¤</div>
                <div class="logo-subtitle">íˆ¬ì í•™ìŠµ í”Œë«í¼</div>
            </div>
            <div class="nav-menu">
                <div class="nav-item" onclick="navigateTo('home')">
                    <span class="nav-icon">ğŸ </span><span>Home</span>
                </div>
                <div class="nav-item" onclick="navigateTo('news')">
                    <span class="nav-icon">ğŸ“°</span><span>News</span>
                </div>
                <div class="nav-item" onclick="navigateTo('sector')">
                    <span class="nav-icon">ğŸ­</span><span>Sector</span>
                </div>
                <div class="nav-item" onclick="navigateTo('company')">
                    <span class="nav-icon">ğŸ¢</span><span>Company</span>
                </div>
                <div class="nav-item active" onclick="navigateTo('mock-invest')">
                    <span class="nav-icon">ğŸ“ˆ</span><span>Mock Invest</span>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="page-header">
                <div class="breadcrumb">Home â†’ Mock Invest</div>
                <h1 class="page-title">ğŸ“ˆ ëª¨ì˜íˆ¬ì ì‹œë®¬ë ˆì´ì…˜</h1>
                <p class="page-subtitle">ê³¼ê±° ì´ìŠˆ ì‹œì ìœ¼ë¡œ ëŒì•„ê°€ "ë§Œì•½ ê·¸ë•Œ íˆ¬ìí–ˆë‹¤ë©´?"ì„ ì²´í—˜í•´ë³´ì„¸ìš”.</p>
            </div>
            
            <div class="simulation-steps">
                <div class="step active" id="step-1"><span>1ï¸âƒ£</span><span>ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</span></div>
                <div class="step inactive" id="step-2"><span>2ï¸âƒ£</span><span>íˆ¬ì ì„¤ì •</span></div>
                <div class="step inactive" id="step-3"><span>3ï¸âƒ£</span><span>ì¢…ëª© ì„ íƒ</span></div>
                <div class="step inactive" id="step-4"><span>4ï¸âƒ£</span><span>ì‹œë®¬ë ˆì´ì…˜</span></div>
                <div class="step inactive" id="step-5"><span>5ï¸âƒ£</span><span>ê²°ê³¼ ë¶„ì„</span></div>
            </div>
            
            <div id="step-content">
                <div class="scenario-section" id="scenario-section">
                    <h2 class="section-title">ğŸ¯ ê³¼ê±° ì´ìŠˆ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</h2>
                    <div class="scenarios-grid" id="scenarios-container"></div>
                </div>
                <div class="investment-setup" id="investment-setup" style="display: none;">
                    </div>
                <div class="stock-selection" id="stock-selection" style="display: none;">
                    </div>
                <div class="simulation-run" id="simulation-run" style="display: none;">
                    </div>
                <div class="results-section" id="results-section" style="display: none;">
                    </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" id="back-btn" onclick="prevStep()" style="display:none;">ì´ì „ ë‹¨ê³„</button>
                <button class="btn btn-primary" id="next-btn" onclick="nextStep()" disabled>ë‹¤ìŒ ë‹¨ê³„</button>
            </div>
        </div>
    </div>
    
    <script>
        // --- ì „ì—­ ìƒíƒœ ë³€ìˆ˜ ---
        let currentStep = 1;
        let scenariosData = [];
        let simulationState = {
            scenarioId: null,
            investmentAmount: 1000000,
            investmentPeriod: 3,
            selectedStocks: []
        };

        // --- ì´ˆê¸° ì‹¤í–‰ ---
        document.addEventListener('DOMContentLoaded', loadScenarios);

        // --- API í˜¸ì¶œ ---
        async function loadScenarios() {
            const container = document.getElementById('scenarios-container');
            container.innerHTML = `<div class="loading"><div class="spinner"></div><p>ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>`;
            try {
                // [ìˆ˜ì •] ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ API í˜¸ì¶œ
                const response = await fetch('/api/simulations/scenarios');
                if (!response.ok) throw new Error('ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì‹¤íŒ¨');
                scenariosData = await response.json();
                displayScenarios(scenariosData);
            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="loading"><p style="color:red;">${error.message}</p></div>`;
            }
        }

        async function loadScenarioDetails(scenarioId) {
            const container = document.getElementById('stock-selection');
            container.innerHTML = `<div class="loading"><div class="spinner"></div><p>ì¶”ì²œ ì¢…ëª©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>`;
            try {
                // [ìˆ˜ì •] ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸ ì •ë³´ ë° ì¶”ì²œ ì¢…ëª© API í˜¸ì¶œ
                const response = await fetch(`/api/simulations/scenarios/${scenarioId}`);
                if (!response.ok) throw new Error('ì‹œë‚˜ë¦¬ì˜¤ ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨');
                const details = await response.json();
                displayStockSelection(details.recommended_stocks);
            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="loading"><p style="color:red;">${error.message}</p></div>`;
            }
        }
        
        async function runSimulation() {
            const runSection = document.getElementById('simulation-run');
            runSection.innerHTML = `<div class="loading"><div class="spinner"></div><p>ì‹œë®¬ë ˆì´ì…˜ API ìš”ì²­ ì¤‘...</p></div>`;
            
            try {
                // [ìˆ˜ì •] ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ API í˜¸ì¶œ
                const response = await fetch('/api/simulations/run', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(simulationState)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail.errors.join(', ') || 'ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ ì‹¤íŒ¨');
                }
                const results = await response.json();
                simulationState.results = results; // ê²°ê³¼ ì €ì¥
                nextStep(); // ê²°ê³¼ í‘œì‹œ ë‹¨ê³„ë¡œ ì´ë™
            } catch (error) {
                console.error(error);
                runSection.innerHTML = `<div class="loading"><p style="color:red;">${error.message}</p><button onclick="resetSimulation()">ë‹¤ì‹œ ì‹œì‘</button></div>`;
            }
        }

        // --- UI ë Œë”ë§ í•¨ìˆ˜ë“¤ ---
        function displayScenarios(scenarios) {
            const container = document.getElementById('scenarios-container');
            container.innerHTML = '';
            scenarios.forEach(s => {
                const card = document.createElement('div');
                card.className = 'scenario-card';
                card.onclick = () => selectScenario(s.id, card);
                card.innerHTML = `<div class="scenario-date">${s.period}</div><div class="scenario-title">${s.name}</div><p>${s.description}</p>`;
                container.appendChild(card);
            });
        }
        
        function displayStockSelection(recommendedStocks) {
            const container = document.getElementById('stock-selection');
            let content = `<h2 class="section-title">ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±</h2>`;
            for (const industry in recommendedStocks) {
                content += `
                    <div class="industry-section">
                        <div class="industry-header"><div class="industry-name">${industry}</div></div>
                        <div class="stocks-grid">
                            ${recommendedStocks[industry].map(stock => `
                                <div class="stock-item">
                                    <input type="checkbox" class="stock-checkbox" data-code="${stock.code}" data-name="${stock.name}" data-industry="${industry}" onchange="toggleStock(this)">
                                    <div class="stock-info"><div class="stock-name">${stock.name}</div><div class="stock-code">${stock.code}</div></div>
                                    <input type="number" class="allocation-input" placeholder="%" min="0" max="100" onchange="updateAllocation('${stock.code}', this.value)" disabled>
                                </div>`).join('')}
                        </div>
                    </div>`;
            }
            container.innerHTML = content;
        }
        
        function displayResults() {
            const results = simulationState.results;
            const container = document.getElementById('results-section');
            // [ìˆ˜ì •] ì‹¤ì œ API ê²°ê³¼ë¡œ ê²°ê³¼ UIë¥¼ ì±„ì›ë‹ˆë‹¤.
            // ... (ê¸°ì¡´ results-sectionì˜ ë‚´ë¶€ HTMLì„ ìƒì„±í•˜ëŠ” ì½”ë“œ) ...
        }

        // --- ìƒíƒœ ê´€ë¦¬ ë° ë„¤ë¹„ê²Œì´ì…˜ ---
        function selectScenario(scenarioId, cardElement) {
            document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('selected'));
            cardElement.classList.add('selected');
            simulationState.scenarioId = scenarioId;
            document.getElementById('next-btn').disabled = false;
        }

        function nextStep() {
            if (currentStep >= 5) return;
            currentStep++;
            updateUI();
            if (currentStep === 3) loadScenarioDetails(simulationState.scenarioId);
            if (currentStep === 4) runSimulation();
        }
        
        function prevStep() {
            if (currentStep <= 1) return;
            currentStep--;
            updateUI();
        }

        function updateUI() {
            // ë‹¨ê³„ë³„ UI í‘œì‹œ/ìˆ¨ê¹€ ë° ë²„íŠ¼ ìƒíƒœ ê´€ë¦¬
            const sections = ['scenario-section', 'investment-setup', 'stock-selection', 'simulation-run', 'results-section'];
            sections.forEach((id, index) => {
                document.getElementById(id).style.display = (index + 1 === currentStep) ? 'block' : 'none';
            });
            // ... (ë‚˜ë¨¸ì§€ UI ì—…ë°ì´íŠ¸ ë¡œì§) ...
        }
        
        function resetSimulation() {
            // ì‹œë®¬ë ˆì´ì…˜ ìƒíƒœ ì´ˆê¸°í™” ë° 1ë‹¨ê³„ë¡œ ì´ë™
            currentStep = 1;
            simulationState = { scenarioId: null, investmentAmount: 1000000, investmentPeriod: 3, selectedStocks: [] };
            updateUI();
            displayScenarios(scenariosData); // ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ë‹¤ì‹œ í‘œì‹œ
        }
        
       // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        function formatContextForModal(items, type) {
            if (!items || items.length === 0) {
                return `<div style="color:#666; text-align:center; padding:2rem;">ê´€ë ¨ ${type} ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
            }
            return items.map((item, idx) => `
                <div style="margin-bottom:1rem; padding-bottom: 1rem; border-bottom: 1px solid #eee;">
                    <div style="font-weight:bold; margin-bottom:0.5rem;">
                        ${idx + 1}. ${item.name}
                    </div>
                    <div style="color:#666; font-size:0.9rem;">${item.description}</div>
                </div>
            `).join('');
        }

        function getScoreColor(score) {
            if (score >= 8.5) return '#dc3545';
            if (score >= 7.0) return '#ffc107';
            return '#28a745';
        }

        function updateIssueCounts(count) {
            document.getElementById('issue-count').textContent = count;
            document.getElementById('grid-issue-count').textContent = count;
        }

        function navigateTo(page) {
            const pages = {
                'home': '/static/index.html',
                'news': '/static/news.html', 
                'sector': '/static/sector.html',
                'company': '/static/company.html',
                'mock-invest': '/static/mock-invest.html'
            };
            if (page !== 'home') window.location.href = pages[page];
        }

        function showNotification(message, type = 'info') {
            // 1. ì•Œë¦¼ ì¢…ë¥˜ì— ë”°ë¥¸ ìƒ‰ìƒ ë§µ ì •ì˜
            const colors = {
                success: 'linear-gradient(135deg, #28a745, #218838)',
                warning: 'linear-gradient(135deg, #ffc107, #e0a800)',
                error: 'linear-gradient(135deg, #dc3545, #c82333)',
                info: 'linear-gradient(135deg, #17a2b8, #138496)'
            };

            // 2. ì•Œë¦¼ì„ ë‹´ì„ div ìš”ì†Œ ìƒì„±
            const notification = document.createElement('div');

            // 3. ì•Œë¦¼ ì°½ ìŠ¤íƒ€ì¼ ì§€ì • (ì¸ë¼ì¸ CSS)
            notification.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                background: ${colors[type] || colors.info}; 
                color: white; 
                padding: 16px 24px; 
                border-radius: 8px; 
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 9999;
                font-weight: 500;
                max-width: 400px;
                animation: slideIn 0.4s ease-out;
                display: flex;
                align-items: center;
                gap: 15px;
            `;
            
            // Keyframes ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ íƒœê·¸ ì¶”ê°€
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(110%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);


            // 4. ì•Œë¦¼ ë©”ì‹œì§€ì™€ ë‹«ê¸° ë²„íŠ¼ ì¶”ê°€
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" 
                        style="background: none; border: none; color: white; font-size: 20px; cursor: pointer; line-height: 1;">
                    &times;
                </button>
            `;

            // 5. bodyì— ì•Œë¦¼ ì°½ ì¶”ê°€
            document.body.appendChild(notification);
            
            // 6. 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ì•Œë¦¼ ì°½ ì œê±°
            setTimeout(() => {
                // ì•Œë¦¼ ì°½ì´ ì•„ì§ í™”ë©´ì— ì¡´ì¬í•  ê²½ìš°ì—ë§Œ ì œê±°
                if (notification.parentElement) {
                    notification.remove();
                }
                // ì¶”ê°€í–ˆë˜ ìŠ¤íƒ€ì¼ íƒœê·¸ë„ ì œê±°
                style.remove();
            }, 5000);
        }
    </script>
</body>
</html>