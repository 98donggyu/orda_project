<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë¥´ë‹¤ - ì‚°ì—… ë¶„ì„</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/page.css">
</head>
<body>
    <div class="layout">
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">ì˜¤ë¥´ë‹¤</div>
                <div class="logo-subtitle">íˆ¬ì í•™ìŠµ í”Œë«í¼</div>
            </div>
            <div class="nav-menu">
                <div class="nav-item" onclick="navigateTo('home')"><span class="nav-icon">ğŸ </span><span>Home</span></div>
                <div class="nav-item" onclick="navigateTo('news')"><span class="nav-icon">ğŸ“°</span><span>News</span></div>
                <div class="nav-item active" onclick="navigateTo('sector')"><span class="nav-icon">ğŸ­</span><span>Sector</span></div>
                <div class="nav-item" onclick="navigateTo('company')"><span class="nav-icon">ğŸ¢</span><span>Company</span></div>
                <div class="nav-item" onclick="navigateTo('mock-invest')"><span class="nav-icon">ğŸ“ˆ</span><span>Mock Invest</span></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="page-header">
                <div class="breadcrumb">Home â†’ Sector</div>
                <h1 class="page-title">ğŸ­ ì‚°ì—… ë¶„ì„</h1>
                <p class="page-subtitle">KRX ê¸°ì¤€ ì‚°ì—… ë¶„ë¥˜ë³„ë¡œ ê´€ë ¨ ì´ìŠˆì™€ íˆ¬ì íë¦„ì„ ë¶„ì„í•´ë³´ì„¸ìš”.</p>
            </div>
            
            <div class="search-filter-section">
                <div class="search-box">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" class="search-input" placeholder="ì‚°ì—…ëª…, í‚¤ì›Œë“œë¡œ ê²€ìƒ‰..." id="sector-search">
                </div>
            </div>
            
            <div class="sectors-section">
                <h2 class="section-title" id="sector-list-title">ì£¼ìš” ì‚°ì—… ë¶„ë¥˜</h2>
                <div class="sectors-grid" id="sectors-container"></div>
            </div>
        </div>
    </div>
    
    <script>
        let allSectors = [];
        let searchTimeout;

        document.addEventListener('DOMContentLoaded', () => {
            loadSectors();
            setupEventListeners();
        });

        async function loadSectors(searchTerm = '') {
            const container = document.getElementById('sectors-container');
            container.innerHTML = `<div class="loading"><div class="spinner"></div><p>ì‚°ì—… ì •ë³´ë¥¼ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>`;

            const apiUrl = `/api/database/industries?limit=100&search=${encodeURIComponent(searchTerm)}`;
            
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                
                const sectors = await response.json();
                if (!Array.isArray(sectors)) throw new Error('ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                
                allSectors = sectors;
                displaySectors(allSectors);
                document.getElementById('sector-list-title').textContent = `ì£¼ìš” ì‚°ì—… ë¶„ë¥˜ (${allSectors.length}ê°œ)`;

            } catch (error) {
                console.error('âŒ ì„¹í„° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                container.innerHTML = `<div class="loading"><p class="error-text">${error.message}</p></div>`;
                showNotification('ì‚°ì—… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function displaySectors(sectors) {
            const container = document.getElementById('sectors-container');
            container.innerHTML = '';

            if (sectors.length === 0) {
                container.innerHTML = `<div class="loading"><p>í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ì‚°ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
                return;
            }
            sectors.forEach(sector => container.appendChild(createSectorCard(sector)));
        }

        function createSectorCard(sector) {
            const card = document.createElement('div');
            card.className = 'sector-card';
            
            const icons = {'IT': 'ğŸ’»', 'ê¸ˆìœµ': 'ğŸ¦', 'ì •ìœ ': 'â›½', 'ì˜ë£Œ': 'ğŸ¥', 'ìŒì‹ë£Œ': 'ğŸ½ï¸', 'í™”í•™': 'ğŸ§ª', 'ë°˜ë„ì²´': 'ğŸ“±', 'ë°©ìœ„': 'ğŸ›¡ï¸', 'ìš´ì†¡': 'ğŸš—'};
            const name = sector.krx_name;
            const iconKey = Object.keys(icons).find(key => name.includes(key));
            const icon = iconKey ? icons[iconKey] : 'ğŸ­';

            card.innerHTML = `
                <div class="sector-header">
                    <div class="sector-icon">${icon}</div>
                    <div class="sector-info">
                        <div class="sector-name">${name}</div>
                        <div class="sector-count">${sector.companies || 0}ê°œ ê¸°ì—…</div>
                    </div>
                </div>
                <div class="sector-description">${(sector.description || 'ìƒì„¸ ì„¤ëª… ì—†ìŒ').substring(0, 100)}...</div>
                <div class="sector-stats">
                    <div class="stat-item"><div class="stat-value">${sector.recentIssues || 0}</div><div class="stat-label">ìµœê·¼ ì´ìŠˆ</div></div>
                    <div class="stat-item"><div class="stat-value">${sector.monthlyReturn || '+0.0%'}</div><div class="stat-label">ì›”ê°„ ìˆ˜ìµë¥ </div></div>
                </div>
                <div class="sector-actions">
                    <button class="action-btn btn-primary" onclick="analyzeSector('${name}')">ğŸ“Š ë¶„ì„í•˜ê¸°</button>
                    <button class="action-btn btn-secondary" onclick="viewCompanies('${name}')">ğŸ¢ ê¸°ì—…ë³´ê¸°</button>
                </div>
            `;
            return card;
        }

        function setupEventListeners() {
            const searchInput = document.getElementById('sector-search');
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    loadSectors(e.target.value);
                }, 500);
            });
        }

        function analyzeSector(sectorName) {
            showNotification(`'${sectorName}' ì‚°ì—…ì˜ ìƒì„¸ ë¶„ì„ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì •)`);
        }

        function viewCompanies(sectorName) {
            window.location.href = `/static/company.html?sector=${encodeURIComponent(sectorName)}`;
        }

        function navigateTo(page) {
            const pages = {
                'home': '/static/index.html', 'news': '/static/news.html', 
                'sector': '/static/sector.html', 'company': '/static/company.html', 
                'mock-invest': '/static/mock-invest.html'
            };
            if (window.location.pathname !== pages[page]) {
                window.location.href = pages[page];
            }
        }

        function showNotification(message, type = 'info') {
            const colors = {
                success: 'linear-gradient(135deg, #28a745, #218838)',
                error: 'linear-gradient(135deg, #dc3545, #c82333)',
                info: 'linear-gradient(135deg, #17a2b8, #138496)'
            };
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.background = colors[type] || colors.info;
            notification.innerHTML = `<span>${message}</span><button onclick="this.parentElement.remove()">&times;</button>`;
            document.body.appendChild(notification);
            setTimeout(() => { notification.remove(); }, 5000);
        }
    </script>
</body>
</html>